service: brevis
tenant: orthodoz
app: brevis-app
org: orthodoz

package:
  individually: true

plugins:
  - serverless-webpack
  - serverless-dotenv-plugin
  - serverless-offline

custom:
  webpack:
    includeModules: true
    packager: 'npm'
    excludeFiles: src/**/*.spec.js
  serverless-offline:
    port: 4000
    printOutput: true
    showDuration: true
    skipCacheInvalidation: true

provider:
  name: aws
  runtime: nodejs12.x
  stage: prod
  region: us-east-1
  apiGateway:
    minimumCompressionSize: 1024 # Enable gzip compression for responses > 1 KB
  environment:
    AWS_NODEJS_CONNECTION_REUSE_ENABLED: 1
    MONGODB_CONNECTION_STRING: ${param:MONGODB_CONNECTION_STRING}

functions:
  create:
    handler: src/handler.createShortUrlByHash
    events:
      - http:
          path: hash
          method: POST
          cors: true
  get:
    handler: src/handler.getUrlByHash
    events:
      - http:
          path: url
          method: GET
          cors: true
